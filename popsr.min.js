var popsrCount=0;function popsr(e,b){if($("#popsr"+popsrCount).length){popsrCount++}var f=this;f.options=$.extend({},popsr.prototype.options,b||{});f.popsr=$(f.template());f.setContent(e);f.options.transparent=f.options.transparent==null||f.options.transparent==""||!f.options.transparent?"":" tbg";if(f.options.title==null){$(".popsr-titlebox",f.popsr).remove();$(".modal-header",f.popsr).addClass("onlybtn")}else{if(f.options.titleLink==null){$(".popsr-title",f.popsr).append(f.options.title)}else{$(".popsr-title",f.popsr).append('<a href="'+f.options.titleLink+'">'+f.options.title+"</a>")}if((f.options.buttons.length===0&&!f.options.autoclose)||f.options.closeButton){if(f.options.closeButton){}}if(f.options.titleClass!=null){$(".popsr-titlebox",this.popsr).addClass(f.options.titleClass)}else{$(".popsr-titlebox",this.popsr).addClass("anim")}}if(f.options.buttons.length>0){for(var d=0;d<f.options.buttons.length;d++){var a=(f.options.buttons[d]["class"])?f.options.buttons[d]["class"]:"";var c=$('<span class="btnbox"><button id="" class="btn btn-primary '+a+'" href="#">'+f.options.buttons[d].label+"</button></span>").data("value",f.options.buttons[d].val);c.bind("click",function(){var h=$.data(this,"value");var g=f.options.callback!=null?function(){f.options.callback(h)}:null;f.hide(g)});$(".popsr-actions",this.popsr).append(c)}}else{$(".modal-footer",this.popsr).remove()}if(f.options.buttons.length===0&&f.options.title==null&&!f.options.autoclose){if(f.options.closeButton){}}if(f.options.show){f.show();$(".btnbox button").focus()}if(!f.options.dontClose){}if(f.options.autoclose!=null){setTimeout(function(g){g.hide()},f.options.autoclose,this)}return f}popsr.prototype={options:{transparent:"",timeout:15000,setName:"",autoclose:null,buttons:[],callback:null,closeback:null,center:true,closeButton:true,title:null,titleClass:null,modal:true,modalOpacity:0.6,dontClose:false,show:true,zIndex:9998,disableWidth:false},template:function(){return'<div class="modal popsr '+(this.options.transparent)+" "+this.options.setName+'" id="popsr'+popsrCount+'"><div class="modal-dialog" style="'+(this.options.disableWidth?"width:unset":"")+'"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><div class="modal-title popsr-title"></div></div><div class="modal-body popsr-content">test</div><div class="modal-footer"><div class="popsr-actions"></div></div></div></div></div>'},content:"<div></div>",visible:false,setContent:function(a){if(jQuery.type(a)!=="object"){if(typeof this.options.type!=="undefined"&&this.options.type=="iframe"){}else{if(typeof a!=="undefined"){if(a.length&&a.replace(/(<([^>]+)>)/ig,"").length<75){a='<div class="popsr-inform">'+a+"</div>"}}else{a='<div class="popsr-inform">Error</div>'}}}$(".popsr-content",this.popsr).empty().append(a).trigger("contentchange")},show:function(){if(this.visible){return}if(this.options.modal&&this.modal!=null){}var a=this;a.popsr.appendTo(document.body);a.popsr.css({"z-index":this.options.zIndex+$(".popsr").length}).modal("show").on("hidden.bs.modal",function(){a.hide()});this.visible=true},hide:function(a){if(!this.visible){return}var b=this;b.popsr.modal("hide").data("bs.modal",null);b.popsr.remove();if(a){a.call()}if(!$(".popsr").length){history.pushState("",document.title,window.location.pathname+window.location.search)}if(b.options.modal&&b.modal!=null){}if(b.options.closeback!=null){b.options.closeback()}return this},toggle:function(){this[this.visible?"hide":"show"]();return this}};$.extend(popsr,{close:function(){if($(".popsr").length){$(".popsr").remove()}if($(".popsr-modal").length){$(".popsr-modal").remove()}history.pushState("",document.title,window.location.pathname+window.location.search)},alert:function(c,a){var b=[{id:"ok",label:"OK",val:"OK"}];a=$.extend({closeButton:false,buttons:b,callback:function(){}},a||{},{show:true});return new popsr(c,a)},ask:function(c,d,a){var b=[{id:"yes",label:"Yes",val:"Y","class":"btn-success"},{id:"no",label:"No",val:"N","class":"btn-danger"}];a=$.extend({closeButton:false,modal:true,buttons:b,callback:function(){}},a||{},{show:true,callback:d});return new popsr(c,a)},json:function(b,a,d){a=$.extend(a||{},{show:true,params:{}});var c=new popsr("loading",a);return $.ajax({type:"POST",data:a.data,url:b,async:false,crossDomain:true,xhrFields:{withCredentials:true},dataType:"json",timeout:a.timeout,cache:false,error:function(g,e,f){console.debug(g.responseText);console.debug(f);popsr.close();new popsr("Connection error. Please try again later.",{autoclose:2000})},success:function(f){if(typeof f.redirect!=="undefined"){location.href=URL+f.redirect;popsr.close()}else{if(typeof f.content==="undefined"||f.content.length==0){c.hide()}else{if($(".popsr-content").length){c.setContent(f.content)}else{c=new popsr(f.content,a)}if($(".popsr-content img").length){var e=0;$(".popsr-content img").load(function(){e++})}}}if(typeof d!=="undefined"&&d!==null){d()}}})},loading:function(a){console.debug(a)},load:function(b,a){a=$.extend(a||{},{show:true,params:{}});var c=new popsr("loading",a);$.ajax({type:"POST",data:a.data,url:b,timeout:a.timeout,cache:false,error:function(f,d,e){console.debug(f.responseText);console.debug(e);popsr.close();new popsr("Connection error, please try again.",{autoclose:2000})},success:function(e){if($(".popsr-content").length){c.setContent(e)}else{c=new popsr(e,a)}if(e.length==0){c.hide()}else{if($(".popsr-content img").length){var d=0;$(".popsr-content img").load(function(){d++})}}}})},iframe:function(b,a){a=$.extend(a||{type:"iframe"},{show:true,params:{}});loadObject=new popsr('<iframe src="'+b+'" frameborder="0" style="" />',a)},img:function(c,b){new popsr.loading.create();var a=$(new Image()).attr("src",c);$(a).load(function(){var d={width:$(window).width()-50,height:$(window).height()-50};var e=(this.width>d.width||this.height>d.height)?Math.min(d.width/this.width,d.height/this.height):1;b=$.extend(b||{},{show:true,closeButton:true,padding:0,disableWidth:true});new popsr.loading.remove();new popsr(a,b)}).error(function(){new popsr.loading.remove();console.log("Error loading "+c)}).attr("src",c)},update:function(b,a){a=$.extend(a||{},{show:true,params:{}});if($(b).length){$(b).attr("data-oldvalue",$(b).val());$(b).addClass("popsr-Update");$(b).mouseover(function(){$(b).addClass("popsr-UpdateMO")});$(b).mouseout(function(){$(b).removeClass("popsr-UpdateMO")});$(b).focus(function(){$(b).addClass("popsr-UpdateActive")});$(b).blur(function(){$(b).removeClass("popsr-UpdateActive")});$($(b)).keyup(function(c){if(c.which==13){$(b).blur()}else{if(c.which==27){$(b).val($(b).attr("data-oldvalue"));$(b).blur()}}});$(b).blur(function(){if($(b).attr("data-oldvalue")!=$(b).val()){var c=new popsr("loading",a);popsr_update=$.ajax({type:"POST",dataType:"json",crossDomain:true,xhrFields:{withCredentials:true},data:$(b).serialize(),url:$(b).data("popsr-update-url"),timeout:a.timeout,cache:false,error:function(f,d,e){popsr.close();new popsr("Connection error, please try again.",{autoclose:2000})},success:function(e){if(typeof e.redirect!=="undefined"){location.href=URL+e.redirect;popsr.close()}else{if(typeof e.content==="undefined"||e.content.length==0){c.hide()}else{if($(".popsr-content").length){c.setContent(e.content)}else{c=new popsr(e.content,a)}if($(".popsr-content img").length){var d=0;$(".popsr-content img").load(function(){d++})}}if(e.result==true){$(b).attr("data-oldvalue",$(b).val())}else{$(b).val($(b).attr("data-oldvalue"));c.setContent(e.content)}}}})}})}}});$.extend(popsr.loading,{create:function(){var a=$("<div id='loadingfnc' style='position: fixed;top:0;left:0;width:100%;height:100%;z-index:10000;background:rgba(255,255,255,0.2);'><img src='"+THEMEURL+"/images/loading.gif' width='30' height='30' style='position: fixed;left: 0;right: 0;margin: auto;top: 50%;transform: translateY(-50%);' /></div>");a.appendTo($("body"))},remove:function(){$("#loadingfnc").remove()}});