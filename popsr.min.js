var popsrCount=0;function popsr(e,b){if($("#popsr"+popsrCount).length){popsrCount++}var f=this;f.options=$.extend({},popsr.prototype.options,b||{});f.popsr=$(f.template());if(f.options.dataobject!==null&&!e.length){e=f.options.dataobject.html()}if(e==="loading"){e=$("<div id='loadingfnc' style='position: fixed;top:0;left:0;width:100%;height:100%;z-index:10000;background:rgba(255,255,255,0.2);'><img src='"+THEMEURL+"images/loading.gif' style='width:auto;position: fixed;left: 0;right: 0;margin: auto;top: 50%;transform: translateY(-50%);' /></div>")}f.setContent(e);f.options.transparent=f.options.transparent==null||f.options.transparent==""||!f.options.transparent?"":" tbg";if(f.options.title==null){$(".popsr-titlebox",f.popsr).remove();$(".modal-header",f.popsr).addClass("onlybtn")}else{if(f.options.titleLink==null){$(".popsr-title",f.popsr).append(f.options.title)}else{$(".popsr-title",f.popsr).append('<a href="'+f.options.titleLink+'">'+f.options.title+"</a>")}if((f.options.buttons.length===0&&!f.options.autoclose)||f.options.closeButton){if(f.options.closeButton){}}if(f.options.titleClass!=null){$(".popsr-titlebox",this.popsr).addClass(f.options.titleClass)}else{$(".popsr-titlebox",this.popsr).addClass("anim")}}if(f.options.buttons.length>0){for(var d=0;d<f.options.buttons.length;d++){var a=typeof(f.options.buttons[d]["class"])!=="undefined"&&f.options.buttons[d]["class"].length?f.options.buttons[d]["class"]:"btn btn-success";var c=$('<span class="btnbox"><button id="" class="'+a+'" href="#">'+f.options.buttons[d].label+"</button></span>").data("value",f.options.buttons[d].val);c.bind("click",function(){var h=$.data(this,"value");var g=f.options.callback!=null?function(){f.options.callback(h)}:null;f.hide(g)});$(".popsr-actions",this.popsr).append(c)}}else{$(".modal-footer",this.popsr).remove()}if(f.options.buttons.length===0&&f.options.title==null&&!f.options.autoclose){if(f.options.closeButton){}}if(f.options.show){f.show();$(".btnbox button").focus()}if(!f.options.dontClose){}$(f.popsr).on("hidden.bs.modal",function(){f.hide()});if(f.options.autoclose!=null){setTimeout(function(g){g.hide()},f.options.autoclose,this)}return f}popsr.prototype={options:{dataobject:null,transparent:"",timeout:15000,setName:"",autoclose:null,buttons:[],callback:null,disableClose:false,closeback:null,center:true,closeButton:true,title:null,titleClass:null,modal:true,modalOpacity:0.6,dontClose:false,show:true,zIndex:9998,disableWidth:false},template:function(){return'<div class="modal popsr '+(this.options.transparent)+" "+this.options.setName+'" id="popsr'+popsrCount+'" '+(this.options.disableClose?'data-keyboard="false" data-backdrop="static"':"")+'><div class="modal-dialog" style="'+(this.options.disableWidth?"max-width:unset":"")+'"><div class="modal-content"><div class="modal-header"><div class="modal-title popsr-title"></div><button type="button" class="close" data-dismiss="modal">&times;</button></div><div class="modal-body popsr-content"></div><div class="modal-footer"><div class="popsr-actions"></div></div></div></div></div>'},content:"<div></div>",visible:false,setContent:function(a){if(jQuery.type(a)!=="object"){if(typeof this.options.type!=="undefined"&&this.options.type==="iframe"){}else{if(typeof a!=="undefined"){if(a.length&&a.replace(/(<([^>]+)>)/ig,"").length<75){a='<div class="popsr-inform">'+a+"</div>"}}else{a='<div class="popsr-inform">Error</div>'}}}$(".popsr-content",this.popsr).empty().append(a).trigger("contentchange")},show:function(){if(this.visible){return}this.popsr.appendTo(document.body);var a=parseInt(this.options.zIndex)+($(".popsr").length*2)+1;this.popsr.css({"z-index":a});if(this.options.modal&&this.modal!==null){this.popsr.on("shown.bs.modal",function(){$(this).next(".modal-backdrop").css("z-index",a-1)})}this.popsr.modal("show");this.visible=true},hide:function(a){if(!this.visible){return}var b=this;if(typeof(a)==="undefined"){if(b.options.callback!==null){b.options.callback(0)}}b.popsr.modal("hide").data("bs.modal",null).remove();if(a){a.call()}if(!$(".popsr").length){history.pushState("",document.title,window.location.pathname+window.location.search)}if(b.options.modal&&b.modal!=null){}if(b.options.closeback!=null){b.options.closeback()}return this},toggle:function(){this[this.visible?"hide":"show"]();return this}};$.extend(popsr,{close:function(a){$(".popsr").modal("hide").remove();history.pushState("",document.title,window.location.pathname+window.location.search)},alert:function(c,a){var b=[{id:"ok",label:"OK",val:"OK"}];a=$.extend({closeButton:false,buttons:b,callback:function(){}},a||{},{show:true});return new popsr(c,a)},ask:function(c,d,a){var b=[{id:"yes",label:"Yes",val:"Y","class":"btn btn-success"},{id:"no",label:"No",val:"N","class":"btn btn-danger"}];a=$.extend({closeButton:false,modal:true,buttons:b,callback:function(){}},a||{},{show:true,callback:d});return new popsr(c,a)},json:function(b,a,d){a=$.extend(a||{},{show:true,params:{}});var c=new popsr("loading",a);return $.ajax({type:"POST",data:a.data,url:b,async:false,crossDomain:true,xhrFields:{withCredentials:true},dataType:"json",timeout:a.timeout,cache:false,error:function(g,e,f){console.debug(g.responseText);console.debug(f);popsr.close();new popsr("Connection error. Please try again later.",{autoclose:2000})},success:function(e){if(typeof e.redirect!=="undefined"){location.href=URL+e.redirect;popsr.close()}else{if(typeof e.content==="undefined"||e.content.length==0){c.hide()}else{if($(".popsr-content").length){c.setContent(e.content)}else{c=new popsr(e.content,a)}}}if(typeof d!=="undefined"&&d!==null){d()}}})},loading:function(a){console.debug(a)},load:function(b,a){a=$.extend(a||{},{show:true,params:{}});var c=new popsr("loading",a);$.ajax({type:"POST",data:a.data,url:b,timeout:a.timeout,cache:false,crossDomain:true,xhrFields:{withCredentials:true},error:function(f,d,e){console.debug(f.responseText);console.debug(e);popsr.close();new popsr("Connection error, please try again.",{autoclose:2000})},success:function(d){if($(".popsr-content").length){c.setContent(d)}else{c=new popsr(d,a)}if(d.length==0){c.hide()}else{}}})},iframe:function(b,a){a=$.extend(a||{},{type:"iframe",show:true,params:{}});loadObject=new popsr('<iframe src="'+b+'" frameborder="0" style="" />',a)},img:function(c,b){new popsr.loading.create();var a=$(new Image()).attr("src",c).addClass("img-responsive").css({"max-height":"100%","max-width":"100%"});new popsr(a,$.extend(b||{},{show:true,closeButton:true,padding:0,disableWidth:true}));new popsr.loading.remove()},update:function(b,a){a=$.extend(a||{},{show:true,params:{}});if($(b).length){$(b).attr("data-oldvalue",$(b).val());$(b).addClass("popsr-Update");$(b).mouseover(function(){$(b).addClass("popsr-UpdateMO")});$(b).mouseout(function(){$(b).removeClass("popsr-UpdateMO")});$(b).focus(function(){$(b).addClass("popsr-UpdateActive")});$(b).blur(function(){$(b).removeClass("popsr-UpdateActive")});$($(b)).keyup(function(c){if(c.which==13){$(b).blur()}else{if(c.which==27){$(b).val($(b).attr("data-oldvalue"));$(b).blur()}}});$(b).blur(function(){if($(b).attr("data-oldvalue")!=$(b).val()){var c=new popsr("loading",a);popsr_update=$.ajax({type:"POST",dataType:"json",crossDomain:true,xhrFields:{withCredentials:true},data:$(b).serialize(),url:$(b).data("popsr-update-url"),timeout:a.timeout,cache:false,error:function(f,d,e){popsr.close();new popsr("Connection error, please try again.",{autoclose:2000})},success:function(d){if(typeof d.redirect!=="undefined"){location.href=URL+d.redirect;popsr.close()}else{if(typeof d.content==="undefined"||d.content.length==0){c.hide()}else{if($(".popsr-content").length){c.setContent(d.content)}else{c=new popsr(d.content,a)}}if(d.result==true){$(b).attr("data-oldvalue",$(b).val())}else{$(b).val($(b).attr("data-oldvalue"));c.setContent(d.content)}}}})}})}}});$.extend(popsr.loading,{create:function(){var a=$("<div id='loadingfnc' style='position: fixed;top:0;left:0;width:100%;height:100%;z-index:10000;background:rgba(255,255,255,0.2);'><img src='"+THEMEURL+"images/loading.gif' width='160' height='24' style='position: fixed;left: 0;right: 0;margin: auto;top: 50%;transform: translateY(-50%);' /></div>");a.appendTo($("body"))},remove:function(){$("#loadingfnc").remove()}});