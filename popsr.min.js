var $=jQuery.noConflict();var popsrCount=0;window.popsr=function(e,b){if($("#popsr"+popsrCount).length){popsrCount++}var f=this;f.options=$.extend({},popsr.prototype.options,b||{});if(f.options.dataobject!==null&&(!e||!e.length)){e=f.options.dataobject.html()}if(e==="loading"){e=$("<div id='loadingfnc' style=''><img src='"+THEMEURL+"images/loading.gif' style='' /></div>")}if(f.options.disableClose){f.options.closeButton=false}f.options.transparent=f.options.transparent===null||f.options.transparent===""||!f.options.transparent?"":(typeof(f.options.transparent)==="boolean"?" tbg":" "+f.options.transparent);f.popsr=$(f.template());f.setContent(e);if(f.options.title===null){$(".popsr-titlebox",f.popsr).remove();$(".modal-header",f.popsr).addClass("onlybtn")}else{$(".popsr-title",f.popsr).append(f.options.titleLink===null?f.options.title:'<a href="'+f.options.titleLink+'">'+f.options.title+"</a>");if((f.options.buttons.length===0&&!f.options.autoclose)||f.options.closeButton){if(f.options.closeButton){}}if(f.options.titleClass!==null){$(".popsr-titlebox",this.popsr).addClass(f.options.titleClass)}else{$(".popsr-titlebox",this.popsr).addClass("anim")}}if(f.options.buttons.length>0){for(var d=0;d<f.options.buttons.length;d++){var a=typeof(f.options.buttons[d]["class"])!=="undefined"&&f.options.buttons[d]["class"].length?f.options.buttons[d]["class"]:"btn btn-success";var c=$('<button id="" class="btnbox '+a+'" href="#">'+f.options.buttons[d].label+"</button>");if(typeof f.options.buttons[d].val==="string"){c.data("value",f.options.buttons[d].val)}c.data("value",f.options.buttons[d].val).bind("click",{val:f.options.buttons[d].val},function(h){var g=typeof h.data.val==="function"?h.data.val():$.data(this,"value");if(f.options.callback!==null){f.options.callback(g);f.options.callback=null}f.hide(null)});$(".popsr-actions",this.popsr).append(c)}}else{$(".modal-footer",this.popsr).remove()}if(f.options.buttons.length===0&&f.options.title===null&&!f.options.autoclose){if(f.options.closeButton){}}if(f.options.show){f.show();$(".popsr-actions button:first-child").focus()}$(f.popsr).on("hidden.bs.modal",function(){f.hide()});if(f.options.autoclose!==null){popsr.autoclose(f,f.options.autoclose)}f.popsr.data({popsr:f});if(f.options.afterInit!==null){f.options.afterInit(f.popsr)}return f};popsr.prototype={options:{dataobject:null,transparent:"",timeout:120000,setName:"",afterShow:null,autoclose:null,buttons:[],afterInit:null,callback:null,disableClose:false,closeback:null,center:true,closeButton:true,title:null,titleClass:null,titleLink:null,parent:null,modal:true,modalOpacity:0.6,show:true,zIndex:9998,disableWidth:false},template:function(){return'<div data-backdrop="'+(this.options.modal?"true":"false")+'" class="modal popsr '+(this.options.transparent)+" "+this.options.setName+'" id="popsr'+popsrCount+'" '+(this.options.disableClose?'data-keyboard="false" data-backdrop="static"':"")+'><div class="modal-dialog container" style="'+(this.options.disableWidth?"max-width:unset!important":"")+'"><div class="modal-content"><div class="modal-header"><div class="modal-title popsr-title"></div>'+(this.options.closeButton?'<button type="button" class="close" data-dismiss="modal">&times;</button>':"")+'</div><div class="modal-body popsr-content"></div><div class="modal-footer popsr-actions"></div></div></div></div>'},content:"<div></div>",visible:false,setContent:function(a){if(typeof(a)!=="object"){if(typeof this.options.type!=="undefined"&&this.options.type==="iframe"){}else{if(typeof a!=="undefined"){if(a.length&&a.replace(/(<([^>]+)>)/ig,"").length<75){a='<div class="popsr-inform">'+a+"</div>"}}else{a='<div class="popsr-inform">Error</div>'}}}$(".popsr-content",this.popsr).empty().append(a).trigger("contentchange")},show:function(){var b=this;if(b.visible){return}b.popsr.appendTo(b.options.parent!==null?b.options.parent:document.body);var a=parseInt(this.options.zIndex)+($(".popsr").length*2)+1;b.popsr.css({"z-index":a});if(b.options.modal){b.popsr.on("shown.bs.modal",function(){b.options.modal=$(this).next(".modal-backdrop");b.options.modal.css("z-index",a-1)})}b.popsr.modal("show");b.visible=true;b.popsr.animate({scrollTop:0},100);if(typeof b.options.afterShow==="function"){b.options.afterShow(b.popsr)}},hide:function(a){if(!this.visible){return}this.visible=false;var b=this;if(typeof(a)==="undefined"){if(b.options.callback!==null){b.options.callback(0)}}b.popsr.modal("hide").data("bs.modal",null).remove();if(a){a.call()}if(!$(".popsr").length){history.pushState("",document.title,window.location.pathname+window.location.search)}if(b.options.modal&&b.options.modal.length){b.options.modal.animate({opacity:0},500,function(){this.remove()})}if(b.options.closeback!==null){b.options.closeback()}return this},toggle:function(){this[this.visible?"hide":"show"]();return this}};$.extend(popsr,{autoclose:function(b,a){setTimeout(function(){b.hide()},a)},close:function(b){var a=$(".popsr");if(typeof b==="string"){a=$(".popsr."+b)}if(typeof b==="object"){a=b}if(a.length){$(a).each(function(){$(this).data("popsr").hide()})}},alert:function(c,a){var b=[{id:"ok",label:"OK",val:"OK"}];a=$.extend({closeButton:false,buttons:b,callback:function(){}},a||{},{show:true});return new popsr(c,a)},ask:function(c,d,a){var b=[{id:"yes",label:typeof(language_data.yes)!=="undefined"?language_data.yes:"Yes",val:"Y","class":"btn btn-success"},{id:"no",label:typeof(language_data.no)!=="undefined"?language_data.no:"No",val:"N","class":"btn btn-danger"}];a=$.extend({closeButton:false,modal:true,buttons:b,callback:function(){}},a||{},{show:true,callback:d});return new popsr(c,a)},exist:function(){return $(".popsr").length},json:function(b,a,d){a=$.extend(a||{},{show:true,params:{}});var c=new popsr("loading",a);return $.ajax({type:"POST",data:a.data,url:b,async:false,crossDomain:true,xhrFields:{withCredentials:true},dataType:"json",timeout:a.timeout,cache:false,error:function(g,e,f){console.debug(g.responseText);console.debug(f);popsr.close();new popsr("Connection error. Please try again later.",{autoclose:2000})},success:function(e){if(typeof e.redirect!=="undefined"){location.href=URL+e.redirect;popsr.close()}else{if(typeof e.content==="undefined"||e.content.length==0){c.hide()}else{if($(".popsr-content").length){c.setContent(e.content)}else{c=new popsr(e.content,a)}}}if(typeof d!=="undefined"&&d!==null){d()}}})},loading:function(a){},load:function(b,a,d){var c=new popsr("loading",$.extend(a||{},{show:true,callback:typeof(d)==="function"?d:null}));$.ajax({type:"POST",data:a.data,url:b,timeout:a.timeout,cache:false,crossDomain:true,xhrFields:{withCredentials:true},error:function(g,e,f){console.debug(g.responseText);console.debug(f);popsr.close();if(typeof(c.options.callback)==="function"){c.options.callback(g.responseText);c.options.callback=null}},success:function(f){if($(".popsr-content").length){c.setContent(f)}else{c=new popsr(f,a)}if(f.length===0){c.hide()}if(typeof(c.options.callback)==="function"){var e=c.options.callback(f);c.options.callback=null;if(e.length){c.setContent(e)}}}});return c},iframe:function(b,a){window.popsr_loadingobj=new popsr.loading.create({modal:false});a=$.extend(a||{},{type:"iframe",show:true,params:{},afterInit:function(c){$(function(){$("iframe",c).on("load",function(){window.popsr_loadingobj.hide()})})}});return new popsr('<iframe src="'+b+'" name="'+(typeof(a.setName)!=="undefined"?a.setName:"")+'" frameborder="0" style="" />',a)},img:function(c,b){new popsr.loading.create();var a=$(new Image()).attr("src",c).addClass("img-responsive").css({"max-height":"100%","max-width":"100%"});new popsr(a,$.extend(b||{},{show:true,closeButton:true,padding:0,disableWidth:true}));new popsr.loading.remove()},update:function(b,a){a=$.extend(a||{},{show:true,params:{}});if($(b).length){$(b).attr("data-oldvalue",$(b).val());$(b).addClass("popsr-Update");$(b).mouseover(function(){$(b).addClass("popsr-UpdateMO")});$(b).mouseout(function(){$(b).removeClass("popsr-UpdateMO")});$(b).focus(function(){$(b).addClass("popsr-UpdateActive")});$(b).blur(function(){$(b).removeClass("popsr-UpdateActive")});$($(b)).keyup(function(c){if(c.which==13){$(b).blur()}else{if(c.which==27){$(b).val($(b).attr("data-oldvalue"));$(b).blur()}}});$(b).blur(function(){if($(b).attr("data-oldvalue")!=$(b).val()){var c=new popsr("loading",a);popsr_update=$.ajax({type:"POST",dataType:"json",crossDomain:true,xhrFields:{withCredentials:true},data:$(b).serialize(),url:$(b).data("popsr-update-url"),timeout:a.timeout,cache:false,error:function(f,d,e){popsr.close();new popsr("Connection error, please try again.",{autoclose:2000})},success:function(d){if(typeof d.redirect!=="undefined"){location.href=URL+d.redirect;popsr.close()}else{if(typeof d.content==="undefined"||d.content.length==0){c.hide()}else{if($(".popsr-content").length){c.setContent(d.content)}else{c=new popsr(d.content,a)}}if(d.result==true){$(b).attr("data-oldvalue",$(b).val())}else{$(b).val($(b).attr("data-oldvalue"));c.setContent(d.content)}}}})}})}}});$.extend(popsr.loading,{create:function(a){if(navigator.userAgent.search("Safari")>=0&&navigator.userAgent.search("Chrome")<0){console.debug("jQuery popsr: Blocked safari");return false}a=$.extend(a||{},{show:true,disableClose:true,transparent:true,zIndex:15000});return new popsr("loading",a)},remove:function(){if($("#loadingfnc").length){$("#loadingfnc").closest(".popsr").modal("toggle")}}});